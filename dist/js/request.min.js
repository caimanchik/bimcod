(()=>{"use strict";new class{errors={0:"Заполните все обязательные поля",1:"Укажите корректное ФИО",2:"Укажите корректный телефон",3:"Укажите корректный email"};constructor(e){this.formWrapper=e,this.form=e.querySelector(".form-form"),this.incorrect=e.querySelector(".form__incorrect"),this.timeOut=null,this.button=e.querySelector(".button-submit"),this.fields=Array.from(e.querySelectorAll("input")).concat(...e.querySelectorAll("textarea")),this.initValidators(),this.formatPhone(this.fields.find((e=>"phone"===e.name)))}initValidators(){this.button.addEventListener("click",(e=>{e.preventDefault(),this.button.blur();const t=new Set,s=[],r={};for(let e=0;e<this.fields.length;++e){const i=this.fields[e];switch(r[i.name]=i.value,i.name){case"name":i.value.split(" ").length<2&&(t.add(this.errors[1]),s.push(i));break;case"phone":/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/.test(i.value)||(t.add(this.errors[2]),s.push(i)),r[i.name]=i.value.replace(/[^\d]/g,"");break;case"mail":/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/.test(i.value)||(t.add(this.errors[3]),s.push(i));break;case"message":i.value||(t.add(this.errors[0]),s.push(i))}}t.size>0?this.showError(t,s):this.sendRequest(r)})),this.fields.forEach((e=>e.addEventListener("click",(()=>e.classList.remove("wrong")))))}sendRequest(e){!function(e,t){fetch("http://127.0.0.1:8000/api/v1/sendUserResponse",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)})}(0,e)}formatPhone(e){e.addEventListener("keyup",(t=>{if(8===t.keyCode||46===t.keyCode)return;let s="+7 (";if(!e.value)return void(e.value=s);let r=e.value.replace(/[^\d]/g,""),i=0;"8"!==r[0]&&"7"!==r[0]||(i=1),r.length>=i+3?s+=`${r.slice(i,i+3)}) `:s+=r.slice(i),r.length>=i+6?s+=`${r.slice(i+3,i+6)}-`:s+=r.slice(i+3,i+6),r.length>=i+8?s+=`${r.slice(i+6,i+8)}-`:s+=r.slice(i+6,i+8),r.length>=i+8&&(s+=r.slice(i+8,i+10)),e.value=s}))}showError(e,t){this.timeOut&&clearTimeout(this.timeOut),this.incorrect.innerHTML="",e.forEach((e=>{const t=document.createElement("div");t.innerHTML=e,this.incorrect.appendChild(t)})),this.incorrect.classList.add("visible"),t.forEach((e=>e.classList.add("wrong"))),this.timeOut=setTimeout((()=>{this.incorrect.classList.remove("visible"),this.incorrect.innerHtml=""}),5e3)}}(document.querySelector(".consult-form-wrap"))})();