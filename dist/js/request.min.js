(()=>{"use strict";new class{errors={0:"Заполните все обязательные поля",1:"Укажите корректное ФИО",2:"Укажите корректный телефон",3:"Укажите корректный email"};constructor(e){this.formWrapper=e,this.form=e.querySelector(".form-form"),this.incorrect=e.querySelector(".form__incorrect"),this.timeOut=null,this.button=e.querySelector(".button-submit"),this.fields=Array.from(e.querySelectorAll("input")).concat(...e.querySelectorAll("textarea")),this.initValidators(),this.formatPhone(this.fields.find((e=>"phone"===e.name)))}initValidators(){this.button.addEventListener("click",(e=>{e.preventDefault(),this.button.blur();const t=new Set,r=[],s={};for(let e=0;e<this.fields.length;++e){const i=this.fields[e];switch(s[i.name]=i.value,i.name){case"name":i.value.split(" ").length<2&&(t.add(this.errors[1]),r.push(i));break;case"phone":/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/.test(i.value)||(t.add(this.errors[2]),r.push(i)),s[i.name]=i.value.replace(/[^\d]/g,"");break;case"mail":/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/.test(i.value)||(t.add(this.errors[3]),r.push(i));break;case"message":i.value||(t.add(this.errors[0]),r.push(i))}}t.size>0?this.showError(t,r):(document.querySelector(".form-form__loader").classList.add("visible"),document.querySelector(".form-form").classList.add("hidden"),this.sendRequest(s).then((()=>{document.querySelector(".form-form__loader").classList.remove("visible"),document.querySelector(".form-form").classList.remove("hidden")})))})),this.fields.forEach((e=>e.addEventListener("click",(()=>e.classList.remove("wrong")))))}async sendRequest(e){return function(e,t){return fetch("https://bimcod.pythonanywhere.com/api/v1/sendUserResponse",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(t)})}(0,e)}formatPhone(e){e.addEventListener("keyup",(t=>{if(8===t.keyCode||46===t.keyCode)return;let r="+7 (";if(!e.value)return void(e.value=r);let s=e.value.replace(/[^\d]/g,""),i=0;"8"!==s[0]&&"7"!==s[0]||(i=1),s.length>=i+3?r+=`${s.slice(i,i+3)}) `:r+=s.slice(i),s.length>=i+6?r+=`${s.slice(i+3,i+6)}-`:r+=s.slice(i+3,i+6),s.length>=i+8?r+=`${s.slice(i+6,i+8)}-`:r+=s.slice(i+6,i+8),s.length>=i+8&&(r+=s.slice(i+8,i+10)),e.value=r}))}showError(e,t){this.timeOut&&clearTimeout(this.timeOut),this.incorrect.innerHTML="",e.forEach((e=>{const t=document.createElement("div");t.innerHTML=e,this.incorrect.appendChild(t)})),this.incorrect.classList.add("visible"),t.forEach((e=>e.classList.add("wrong"))),this.timeOut=setTimeout((()=>{this.incorrect.classList.remove("visible"),this.incorrect.innerHtml=""}),5e3)}}(document.querySelector(".consult-form-wrap"))})();