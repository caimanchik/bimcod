(()=>{"use strict";class t{constructor(t){this.savedServices,this.savedContent,this.step=0,this.calculator=t,this.wrapperElement=document.querySelector("#calculate-wrapper"),this.calculateContent=document.querySelector("#calculate-content"),this.stepTemplate=document.querySelector("#step-template").content.firstElementChild,this.textTemplate=document.querySelector("#input-text").content.firstElementChild,this.radioTemplate=document.querySelector("#input-radio").content.firstElementChild,this.checkboxTemplate=document.querySelector("#input-checkbox").content.firstElementChild,this.result,this.createCalculator(),this.initPrevButton()}initPrevButton(){this.wrapperElement.querySelector("#prev-button").addEventListener("click",(()=>{delete this.result[this.step],this.step-=2,this.step<0?this.reInitCalculator():this.nextStep()}))}reInitCalculator(){this.calculateContent.innerHTML=this.savedContent,document.querySelector(".main").append(this.savedServices),this.wrapperElement.classList.remove("calculator"),function(){function t(t){t.forEach((t=>{t.isIntersecting&&t.target.classList.add("appear")}))}setTimeout((()=>{let e=document.querySelectorAll("[scroll]"),s={.7:[]};e.forEach((t=>{let e=t.getAttribute("scroll");e=""===e?.7:e,s[e]?s[e].push(t):s[e]=[t]})),Object.keys(s).forEach((e=>{const i=new IntersectionObserver(t,{threshold:e});s[e].forEach((t=>{i.observe(t)}))}))}),500)}(),this.createCalculator()}createCalculator(){const t=document.querySelector("#create-calculator"),e=document.querySelector("#services-services");this.result={},this.step=0,t.addEventListener("click",(()=>{Array.from(e.querySelector(".services__list").children).forEach((t=>t.classList.remove("appear"))),this.savedServices=e,this.savedContent=this.calculateContent.innerHTML,e.remove(),this.wrapperElement.classList.add("calculator"),this.nextStep()}))}initStep(t){this.calculateContent.innerHTML="";const e=this.stepTemplate.cloneNode(!0);this.calculateContent.append(e),e.querySelector("#step-step").textContent=t.step,e.querySelector("#step-title").textContent=t.name,"radio"===t.type?this.initRadioStep(t,e):"text"===t.type?this.initTextStep(t,e):"checkbox"===t.type&&this.initCheckboxStep(t,e),setTimeout((()=>e.classList.add("show")),0)}initTextStep(t,e){const s=this.textTemplate.cloneNode(!0);e.querySelector("#step-inputs").append(s),s.setAttribute("placeholder",t.placeholder),void 0!==this.result[this.step]&&(s.value=this.result[this.step]),s.addEventListener("click",(()=>s.classList.remove("warning"))),this.submitButtonStep(e,(()=>{if(!(2===this.step?this.isCorrectInputedTextLength(s.value):this.isCorrectInputedTextSquare(s.value)))return void s.classList.add("warning");const t=parseFloat(s.value.trim());this.result[this.step]=t,this.nextStep()}))}isCorrectInputedTextLength(t){return!(/[^0-9км .,]/.test(t)||(t.match(/[,.]/g)||[]).length>1||""===t||/[км]/.test(t)&&!t.includes("км")||t.match(/км[ .,]+\d/)||t.match(/км\d/)||!t.match(/\d/)||!(!/[,.]/.test(t)||/[,.]\d/.test(t)&&/\d[,.]/.test(t)))}isCorrectInputedTextSquare(t){return!(/[^0-9 .,]/.test(t)||(t.match(/[,.]/g)||[]).length>1||""===t||!(!/[,.]/.test(t)||/[,.]\d/.test(t)&&/\d[,.]/.test(t)))}initRadioStep(t,e){const s=[];t.variants.forEach(((t,i)=>{const r=this.radioTemplate.cloneNode(!0);e.querySelector("#step-inputs").append(r);const c=r.querySelector("input");this.result[this.step]===i&&(c.checked=!0),c.setAttribute("id","radio"+i),s.push(c),c.addEventListener("change",(()=>{s.forEach((t=>t.classList.remove("warning")))}));const n=r.querySelector("label");n.textContent=t.name,n.setAttribute("for","radio"+i)})),this.submitButtonStep(e,(()=>{let t;s.forEach(((e,s)=>t=e.checked?s:t)),void 0!==t?(this.result[this.step]=t,this.nextStep()):s.forEach((t=>t.classList.add("warning")))}))}initCheckboxStep(t,e){const s=t.variants[this.result[this.step-1]],i=[];s.forEach(((t,s)=>{const r=this.checkboxTemplate.cloneNode(!0);e.querySelector("#step-inputs").append(r);const c=r.querySelector("input");c.setAttribute("id","checkbox"+s),i.push(c),c.addEventListener("change",(()=>{i.forEach((t=>t.classList.remove("warning")))}));const n=r.querySelector("label");n.append(t.name),n.setAttribute("for","checkbox"+s)})),this.submitButtonStep(e,(()=>{const t=i.map(((t,e)=>t.checked?e:-1)).filter((t=>-1!==t));0!==t.length?(this.result[this.step]=t,this.initResultStep()):i.forEach((t=>t.classList.add("warning")))}))}submitButtonStep(t,e){const s=t.querySelector("#submit-step");s.addEventListener("click",(t=>{t.preventDefault(),e(),s.blur()}))}nextStep(){this.step++,1!==this.step?this.initStep(this.calculator.steps[this.step][this.result[1]]):this.initStep(this.calculator.steps[1][0])}initResultStep(){const t=this.calculateResult(),e=document.querySelector("#result-calculator").content.firstElementChild.cloneNode(!0);this.calculateContent.innerHTML="",this.calculateContent.append(e),this.wrapperElement.classList.add("result"),this.calculateContent.querySelector("#result-container").textContent=(100*Math.round(t/100)).toLocaleString(),setTimeout((()=>e.classList.add("show")),0)}calculateResult(){let t;return t=1===this.result[1]?this.calculateLinearResult():this.calculateCapitalResult(),t}calculateLinearResult(){const t=this.calculator.steps[3][1].variants[this.result[3]].k,e=this.result[4].map((t=>this.calculator.steps[4][1].variants[this.result[3]][t].price)).reduce(((t,e)=>e>0?t+e:0),0);return this.result[2]*t*e}calculateCapitalResult(){const t=this.calculator.steps[2][0].variants[this.result[2]].k,e=this.calculator.steps[4][0].variants[this.result[4]].k,s=this.result[5].map((t=>this.calculator.steps[5][0].variants[this.result[4]][t].price)).reduce(((t,e)=>e>0?t+e:0),0);return this.result[3]*t*e*s}}!async function(){const e=await async function(){return fetch("files/pricing.json").then((t=>t.json()))}();new t(e.calculator)}()})();